<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<title>Frontpage</title>
<!-- REPLACE ME WITH A FRAGMENT -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="../public/css/styles.css" th:href="@{/css/styles.css}" rel="stylesheet"/>

</head>
<body>
<div id="nav-fullwidth">
    <!-- REPLACE ME WITH A FRAGMENT -->
    <div id="navbar">
        <div id="logo">
            <img src="../public/images/fog-logo.jpeg" th:src="@{/images/fog-logo.jpeg}" width="60px" height="60px"/>
        </div>
        <ul class="main-menu">
            <li class="button"><a href="/">Hjem</a></li>
            <li class="button"><a href="/bestil-carport">Bestil unik carport</a></li>
            <li class="button"><a href="/login">Login</a></li>
            <li class="button"><a href="/log-ud">Log ud</a></li>
            <!-- <li class="button" th:if="${session.loggedinUser == null}" th:remove="tag"><a href="/min-side" th:text="${session.loggedinUser.email}"></a></li>-->

            <div th:if="${session.currentUser != null}">
                <li class="button"><a href="/min-side" th:text="${session.currentUser.email}"></a></li>
            </div>

            <div th:if="${session.currentUser == null}">
                <li class="button"><a href="/min-side" th:text="test"></a></li>
            </div>
        </ul>
    </div>
</div>

<div id="main-content">

    <p>Du er nu logget ind</p>
    <p class="error_message" th:text="${#ctx.message}"></p>

</div>

<div id="ordre_liste">
    <h2>Hej <span th:text="${session.currentUser.getName()}"/></h2>
    <p>Alle ordre</p>
    <table id="order_table">
        <tr>
            <th>Ordre ID</th>
            <th>Dato</th>
            <th>Kommentar</th>
            <th>
                <select name="status_column" id="status_column" onchange="updateTable()">
                    <option value="alle">Alle</option>
                    <option th:each="status : ${statusList}" th:text="${status.getText()}" th:value="${status.getText()}"></option>
                </select>
            </th>
            <th>
                Handlinger
            </th>
        </tr>
        <tr th:each="order : ${allOrders}">
            <td th:text="${order.getId()}">Ordre ID</td>
            <td th:text="${order.getDate()}">Dato</td>
            <td th:text="${order.getCustomerNote}">Kommentar</td>
            <td>
                <form method="post">
                <select name="status_id">
                    <option th:text="${order.getOrderStatus}" value="current_status" selected></option>
                    <option th:each="status : ${statusList}" th:unless="${status.getText()==order.getOrderStatus}" th:text="${status.getText()}" th:value="${status.getId()}"></option>
                </select>
                    <button type="submit" name="order_id" formaction="/opdater-ordre" th:value="${order.getId()}">Gem</button>
                </form>
            </td>
            <td>
                <form class="taskform" method="post">
                    <button type="submit" name="order_id" th:value="${order.getId()}" formaction="/se-order">Se ordre</button>
                </form>
            </td>
        </tr>
    </table>
</div>
<script>
    function updateTable() {
        var statusSelect = document.getElementById("status_column");
        var selectedStatus = statusSelect.value.toLowerCase();
        var orderTable = document.getElementById("order_table");
        var tableRows = orderTable.getElementsByTagName("tr");

        for (var i = 1; i < tableRows.length; i++) {
            var orderRow = tableRows[i];
            var orderStatusCell = orderRow.getElementsByTagName("td")[3];
            var orderStatusSelect = orderStatusCell.getElementsByTagName("select")[0];
            var orderStatus = orderStatusSelect ? orderStatusSelect.options[orderStatusSelect.selectedIndex].text.toLowerCase() : "";

            if (selectedStatus === "alle" || orderStatus === selectedStatus) {
                orderRow.style.display = "";
            } else {
                orderRow.style.display = "none";
            }
        }
    }

</script>

<footer>
    <!-- REPLACE ME WITH A FRAGMENT -->
    <p id="footer-text">Created by Team LAHY - All rights reserved</p>

</footer>
</body>
</html>